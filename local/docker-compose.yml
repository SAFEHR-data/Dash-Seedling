version: "3.8"

services:

  app:
    image: ${LOCAL_IMAGE_NAME}
    ports:
      - "${LOCAL_APP_PORT}:8000"
    command: python app.py
    volumes:
      - type: bind
        source: ./../app/
        target: /app/

  feature-store:
    image: mcr.microsoft.com/azure-sql-edge
    ports:
      - "${LOCAL_MSSQL_PORT}:1433"
    environment:
      MSSQL_SA_PASSWORD: "${LOCAL_MSSQL_PASSWORD}"
      ACCEPT_EULA: "Y"

  cosmosdb:
    image:  mcr.microsoft.com/cosmosdb/linux/azure-cosmos-emulator
    platform: linux/amd64
    stdin_open: true
    tty: true
    ports:
      - '8081:8081'
      - '8900:8900'
      - '8901:8901'
      - '8902:8902'
      - '10250:10250'
      - '10251:10251'
      - '10252:10252'
      - '10253:10253'
      - '10254:10254'
      - '10255:10255'
      - '10256:10256'
      - '10350:10350'
    environment:
      AZURE_COSMOS_EMULATOR_PARTITION_COUNT: 2
      AZURE_COSMOS_EMULATOR_ENABLE_DATA_PERSISTENCE: true
      AZURE_COSMOS_EMULATOR_IP_ADDRESS_OVERRIDE: "${LOCAL_COSMOS_IP_ADDRESS}"
    volumes:
      - cosmos:/tmp/cosmos/appdata

volumes:
  cosmos:
